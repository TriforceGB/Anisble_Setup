- hosts: localhost
  connection: local
  become: false
  vars:
    the_user: "{{ ansible_user_id }}"

  pre_tasks:
    - name: update repository
      become: true
      pacman:
        update_cache: true
        upgrade: true

    - name: create .config if not already present
      ansible.builtin.file:
        path: ~/.config
        state: directory
        mode: "0755"

    - name: Detect Windows Current User
      ansible.builtin.shell:
        cmd: $env:UserName
      register: windows_user
      changed_when: false
      failed_when: windows_user.rc != 0
      args:
        executable: powershell.exe

    - name: Register Windows Current User
      ansible.builtin.set_fact:
        wsl_host_user: "{{ windows_user.stdout }}"
      when: host_user is not defined

    - name: DEBUG
      ansible.builtin.debug:
        msg: "wsl_host_user: {{ wsl_host_user }}"

  tasks:
    - import_tasks: playbooks/packages.yml
    - import_tasks: playbooks/dotfiles.yml
